<h2>Introduction</h2>

<p>Writing database queries for an Application is always boring and error prone. Came across&nbsp;<a href="https://github.com/aadreja/vega/">Vega</a>&nbsp;&ndash; one of the fastest .net ORM (Object-relational Mapping).</p>

<h2>Background</h2>

<p>I started realising need of an reusable framework which can handle all operations what we need to build enterprise application. The result is Vega. Here I am explaining the simplicty and powerful features of <a href="https://github.com/aadreja/vega">Vega</a>.</p>

<div>Following are the exciting features of Vega: -</div>

<div style="margin-left: 36pt">&nbsp;</div>

<ul>
	<li>Inbuilt Row Versioning</li>
	<li>Powerful Audit Trail to keep track of all changes</li>
	<li>Object Mapping via Emit which are cached to get performance same as manual object mapping.</li>
	<li>Inbuilt Paging without offset is fastest of all. Supports paging with offset as well.</li>
	<li>Concurrency check during Update and Delete.</li>
	<li>Inbuilt implementation of common fields like CreatedBy, CreatedOn, UpdatedBy, UpdatedOn, IsActive, VersionNo</li>
	<li>Define Virtual Foreign Keys to check data integrity on Delete.</li>
	<li>Cross database support for Microsoft SQL Server, PostgreSQL, SQLite</li>
</ul>

<h2>Why Vega?</h2>

<div>Vega is one of the fastest cross platform .net ORM. Below is the performance matrix comparing ADO vs Vega</div>

<h2>Performance Results for 1000 records 5 iteration</h2>

<table border="0" cellpadding="0" cellspacing="0" style="width: 481px">
	<thead>
		<tr>
			<th style="width: 151px">
			<div align="center"><strong>Run</strong></div>
			</th>
			<th style="width: 66px">
			<div align="center"><strong>1</strong></div>
			</th>
			<th style="width: 66px">
			<div align="center"><strong>2</strong></div>
			</th>
			<th style="width: 66px">
			<div align="center"><strong>3</strong></div>
			</th>
			<th style="width: 66px">
			<div align="center"><strong>4</strong></div>
			</th>
			<th style="width: 66px">
			<div align="center"><strong>5</strong></div>
			</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td style="width: 151px">
			<div><strong>Insert Tests</strong></div>
			</td>
			<td style="width: 66px">
			<div>&nbsp;</div>
			</td>
			<td style="width: 66px">
			<div>&nbsp;</div>
			</td>
			<td style="width: 66px">
			<div>&nbsp;</div>
			</td>
			<td style="width: 66px">
			<div>&nbsp;</div>
			</td>
			<td style="width: 66px">
			<div>&nbsp;</div>
			</td>
		</tr>
		<tr>
			<td style="width: 151px">
			<div>- ADO</div>
			</td>
			<td style="width: 66px">
			<div align="center">135ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">126ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">121ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">142ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">151ms</div>
			</td>
		</tr>
		<tr>
			<td style="width: 151px">
			<div>- Vega</div>
			</td>
			<td style="width: 66px">
			<div align="center">212ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">171ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">148ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">177ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">193ms</div>
			</td>
		</tr>
		<tr>
			<td style="width: 151px">
			<div><strong>Update Tests</strong></div>
			</td>
			<td style="width: 66px">&nbsp;</td>
			<td style="width: 66px">&nbsp;</td>
			<td style="width: 66px">&nbsp;</td>
			<td style="width: 66px">&nbsp;</td>
			<td style="width: 66px">&nbsp;</td>
		</tr>
		<tr>
			<td style="width: 151px">
			<div>- ADO</div>
			</td>
			<td style="width: 66px">
			<div align="center">140ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">143ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">483ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">157ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">163ms</div>
			</td>
		</tr>
		<tr>
			<td style="width: 151px">
			<div>- Vega</div>
			</td>
			<td style="width: 66px">
			<div align="center">159ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">163ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">351ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">173ms</div>
			</td>
			<td style="width: 66px">
			<div align="center">162ms</div>
			</td>
		</tr>
		<tr>
			<td style="width: 151px">
			<div><strong>Select Tests</strong></div>
			</td>
			<td style="width: 66px">
			<div>&nbsp;</div>
			</td>
			<td style="width: 66px">
			<div>&nbsp;</div>
			</td>
			<td style="width: 66px">
			<div>&nbsp;</div>
			</td>
			<td style="width: 66px">
			<div>&nbsp;</div>
			</td>
			<td style="width: 66px">
			<div>&nbsp;</div>
			</td>
		</tr>
		<tr>
			<td style="width: 151px">
			<div>- ADO</div>
			</td>
			<td style="width: 66px">
			<div>104ms</div>
			</td>
			<td style="width: 66px">
			<div>106ms</div>
			</td>
			<td style="width: 66px">
			<div>287ms</div>
			</td>
			<td style="width: 66px">
			<div>136ms</div>
			</td>
			<td style="width: 66px">
			<div>133ms</div>
			</td>
		</tr>
		<tr>
			<td style="width: 151px">
			<div>- Vega</div>
			</td>
			<td style="width: 66px">
			<div>133ms</div>
			</td>
			<td style="width: 66px">
			<div>109ms</div>
			</td>
			<td style="width: 66px">
			<div>159ms</div>
			</td>
			<td style="width: 66px">
			<div>143ms</div>
			</td>
			<td style="width: 66px">
			<div>137ms</div>
			</td>
		</tr>
		<tr>
			<td style="width: 151px">
			<div><strong>Select List Tests</strong></div>
			</td>
			<td style="width: 66px">
			<div>&nbsp;</div>
			</td>
			<td style="width: 66px">
			<div>&nbsp;</div>
			</td>
			<td style="width: 66px">
			<div>&nbsp;</div>
			</td>
			<td style="width: 66px">
			<div>&nbsp;</div>
			</td>
			<td style="width: 66px">
			<div>&nbsp;</div>
			</td>
		</tr>
		<tr>
			<td style="width: 151px">
			<div>- ADO</div>
			</td>
			<td style="width: 66px">
			<div>5ms</div>
			</td>
			<td style="width: 66px">
			<div>3ms</div>
			</td>
			<td style="width: 66px">
			<div>3ms</div>
			</td>
			<td style="width: 66px">
			<div>3ms</div>
			</td>
			<td style="width: 66px">
			<div>3ms</div>
			</td>
		</tr>
	</tbody>
</table>

<h2>How to get Vega?</h2>

<div>There are following ways to install &amp; use vega.</div>

<div>
<h2>1.&nbsp;&nbsp;&nbsp;&nbsp;Install from Nuget</h2>
</div>

<div>To get the .NET 4.0 or .NET Standard version of the Vega from Nuget</div>

<div style="margin-left: 39.6pt">1.1.&nbsp;&nbsp;Go to Visual Studio -&gt; Tools -&gt; NuGet Package Manager -&gt; Package Manager Console</div>

<div style="margin-left: 40px"><a href="https://2.bp.blogspot.com/-nXn3nvNHckg/WuP3B4jw6lI/AAAAAAAACtg/qwPp3T9RTJI1kdktmmtJzmrjSkXB9AcKwCLcBGAs/s1600/1.png"><img border="0" height="248" src="c47bfb80-3109-4b5f-93a7-e824f4957cf4.Png" width="320" /></a></div>

<div style="margin-left: 39.6pt">&nbsp;</div>

<div style="margin-left: 35.45pt">&nbsp;</div>

<div style="margin-left: 39.6pt">1.2.&nbsp;&nbsp;In Package Manager Console type &ldquo;Install-Package Vega&rdquo; and hit Enter.</div>

<div style="margin-left: 35.45pt">&nbsp;</div>

<div style="margin-left: 35.45pt">&nbsp;</div>

<div style="margin-left: 40px"><a href="https://4.bp.blogspot.com/-XOoz9bJk2YA/WuP3B63cTZI/AAAAAAAACtc/zBZm9QBBqcYoqG_tGwwO0x8aqpvNzkdhwCEwYBhgL/s1600/2.png"><img border="0" height="130" src="b2784a2c-372e-4d2f-b03b-8f044ce8117e.Png" width="320" /></a></div>

<p>&nbsp;</p>

<div>
<h2>2.&nbsp;&nbsp;&nbsp;&nbsp;Download source code from GitHub</h2>
</div>

<div>To get the source code from GitHub</div>

<div style="margin-left: 39.6pt">2.1.&nbsp;&nbsp;Go to&nbsp;<a href="https://github.com/aadreja/vega/releases">https://github.com/aadreja/vega/releases</a></div>

<div style="margin-left: 39.6pt">2.2.&nbsp;&nbsp;Download the latest release</div>

<div style="margin-left: 40px"><a href="https://3.bp.blogspot.com/-ZCGK17In_UY/WuP3BoHNpoI/AAAAAAAACto/r2OJKv7HyC0Ahd8g8bUEmnN_L9JNqjN5wCEwYBhgL/s1600/3.png"><img border="0" height="307" src="e79e6f0b-700c-41e5-acee-74f51c28645c.Png" width="320" /></a></div>

<div style="margin-left: 39.6pt">&nbsp;</div>

<div style="margin-left: 39.6pt">&nbsp;</div>

<div style="margin-left: 39.6pt">2.3.&nbsp;&nbsp;Unzip source code, add to solution &amp; reference to your project.</div>

<div style="margin-left: 39.6pt">&nbsp;</div>

<h1>How to use Vega?</h1>

<div>Vega is simple to use. Following are steps to begin: -</div>

<h2 style="margin-left: 18pt">1.&nbsp;&nbsp;&nbsp;&nbsp;Onetime startup/optional configuration</h2>

<div style="margin-left: 18pt">By default vega works with default configuration. You may override default configuration in Configuration class. It has to be done once and all settings will be cached till application life.</div>

<div style="margin-left: 18pt">&nbsp;</div>

<pre lang="cs" style="margin-left: 14.2pt">
//Configure Vega
Configuration configuration = new Configuration
{
    CreatedUpdatedByColumnType = DbType.Int32,
    ///...
};

Config.Configure(configuration);</pre>

<div style="margin-left: 18pt">&nbsp;</div>

<h2 style="margin-left: 18pt">2.&nbsp;&nbsp;&nbsp;&nbsp;Create an Entity class derived from Vega.EntityBase</h2>

<div style="margin-left: 40px">Example: -</div>

<pre style="margin-left: 40px">
[Table(NeedsHistory = true)]
public class Country : EntityBase
{
    [PrimaryKey(true)]
    public int Id { get; set; }
    public string Name { get; set; }
    public string ShortCode { get; set; }
}
</pre>

<h2 style="margin-left: 18pt">3.&nbsp;&nbsp;&nbsp;&nbsp;Perform CRUD operations</h2>

<h3 style="margin-left: 39.6pt">3.1.&nbsp;&nbsp;Insert</h3>

<div style="margin-left: 18pt">Simply create Entity &amp; set properties for Insert. Create a connection object, pass it to Repository &amp; call Add method which will return Id of newly create record</div>

<div style="margin-left: 18pt">&nbsp;</div>

<pre lang="cs" style="margin-left: 18pt">
Country country = new Country() 
{ 
   Name = &quot;India&quot;, 
   ShortCode = &quot;IN&quot;, 
   CreatedBy = 1 //user id created record 
}; 

using (SqlConnection connection = new SqlConnection(conString)) 
{ 
   Repository&lt;Country&gt; countryRepo = new Repository&lt;Country&gt;(connection); 
   int result = (int)countryRepo.Add(country); 
}</pre>

<h3 style="margin-left: 39.6pt">3.2.&nbsp;&nbsp;Update</h3>

<div style="margin-left: 18pt">To update record use Update method of repository.</div>

<pre lang="cs" style="margin-left: 18pt">
City city = new City()
{
    Id = 1,
    Name = &quot;Ahmedabad&quot;,
    State = &quot;GU&quot;,
    CountryId = 1,
    Longitude = 102.23m,
    Latitude = 124.23m,
    UpdatedBy = 1
};

using (SqlConnection con = new SqlConnection(connectionString))
{
     Repository&lt;City&gt; cityRepo = new Repository&lt;City&gt;(con);
     bool result = cityRepo.Update(city);
}
</pre>

<h3 style="margin-left: 39.6pt">3.3.&nbsp;&nbsp;Delete</h3>

<div style="margin-left: 18pt">To delete record use Delete method of repository. Soft Delete if Entity contains IsActive column.</div>

<pre lang="cs" style="margin-left: 18pt">
//soft delete
using (SqlConnection con = new SqlConnection(connectionString))
{
     Repository&lt;City&gt; cityRepo = new Repository&lt;City&gt;(con);
     bool result = cityRepo.Delete(1, 1); //Record Id &amp; User Id
}

//hard delete
using (SqlConnection con = new SqlConnection(connectionString))
{
     Repository&lt;City&gt; cityRepo = new Repository&lt;City&gt;(con);
     bool result = cityRepo.HardDelete(1, 1); //Record Id &amp; User Id
}
</pre>

<h3 style="margin-left: 39.6pt">3.4.&nbsp;&nbsp;Read One</h3>

<div style="margin-left: 18pt">Reads first record with specified criteria &amp; converts it to object.</div>

<pre lang="cs" style="margin-left: 18pt">
//read one with specified id
using (SqlConnection con = new SqlConnection(connectionString))
{
     Repository&lt;City&gt; cityRepo = new Repository&lt;City&gt;(con);
     City city = cityRepo.ReadOne(1); //Record Id
}

//read one with specified dynamic criteria
using (SqlConnection con = new SqlConnection(connectionString))
{
     Repository&lt;City&gt; cityRepo = new Repository&lt;City&gt;(con);
     City city = cityRepo.ReadOne(&quot;Name=@Name&quot;, new { Name =&quot;Ahmedabad&quot; }); //Dynamic criteria
}
</pre>

<h3 style="margin-left: 39.6pt">3.5.&nbsp;&nbsp;Read All</h3>

<div style="margin-left: 18pt">Reads all records with specified criteria &amp; converts it to enumerable object which can be converted to List.</div>

<pre lang="cs" style="margin-left: 18pt">
//read all records
using (SqlConnection con = new SqlConnection(connectionString))
{
     Repository&lt;City&gt; cityRepo = new Repository&lt;City&gt;(con);
     List&lt;City&gt; cityList  = cityRepo.ReadAll().ToList();
}

//read all with specified dynamic criteria
using (SqlConnection con = new SqlConnection(connectionString))
{
     Repository&lt;City&gt; cityRepo = new Repository&lt;City&gt;(con);
     List&lt;City&gt; cityList = cityRepo.ReadAll(&quot;Name=@Name&quot;, new { Name = &quot;Ahmedabad&quot; }).ToList(); //Dynamic criteria
}
</pre>

<h3 style="margin-left: 39.6pt">3.6.&nbsp;&nbsp;Read Paged</h3>

<div style="margin-left: 18pt">Reads all records with server side paging, specified criteria &amp; converts it to enumerable object which can be converted to List.</div>

<pre lang="cs" style="margin-left: 18pt">
//read all records (name column) of page no 1 with page size 5
using (SqlConnection con = new SqlConnection(connectionString))
{
     Repository&lt;City&gt; cityRepo = new Repository&lt;City&gt;(con);
     List&lt;City&gt; cityList = cityRepo.ReadAllPaged(&quot;name&quot;, 1, 5).ToList();
}

//read all records (name column) of page 1 with page size 5 &amp; specified dynamic criteria
using (SqlConnection con = new SqlConnection(connectionString))
{
     Repository&lt;City&gt; cityRepo = new Repository&lt;City&gt;(con);
     List&lt;City&gt; cityList = cityRepo.ReadAllPaged(&quot;name&quot;, 1, 5, null, &quot;State=@State&quot;, new { State = &quot;GU&quot; }).ToList(); //Dynamic criteria
}</pre>

<div>&nbsp;</div>

<div>Vega is simple to use &amp; awesome features gets all that is required to build an enterprise application.</div>

<div>&nbsp;</div>

<h2>History</h2>

<p><a href="https://github.com/aadreja/vega/releases/tag/1.0.4">Version 1.0.4</a> - Released</p>
